
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Scaling &#8212; ESSnmx</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=ac0801b5"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user-guide/scaling_workflow';</script>
    <script src="../_static/anaconda-icon.js?v=461bdc62"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Installation" href="installation.html" />
    <link rel="prev" title="McStas Workflow - Chunk by Chunk" href="mcstas_workflow_chunk.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="26.1.0" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.svg" class="logo__image only-light" alt="ESSnmx - Home"/>
    <img src="../_static/logo-dark.svg" class="logo__image only-dark pst-js-only" alt="ESSnmx - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api-reference/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../developer/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about/index.html">
    About
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/plopp">
    Plopp
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/sciline">
    Sciline
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io">
    Scipp
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://scipp.github.io/scippnexus">
    ScippNexus
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/scipp/essnmx" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/essnmx/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://anaconda.org/conda-forge/essnmx" title="Conda" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-anaconda fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Conda</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api-reference/index.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../developer/index.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about/index.html">
    About
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/plopp">
    Plopp
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/sciline">
    Sciline
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io">
    Scipp
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://scipp.github.io/scippnexus">
    ScippNexus
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/scipp/essnmx" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/essnmx/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://anaconda.org/conda-forge/essnmx" title="Conda" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-anaconda fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Conda</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="workflow.html">NMX Reduction Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcstas_workflow.html">McStas Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcstas_workflow_chunk.html">McStas Workflow - Chunk by Chunk</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Scaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
</div>
</nav></div>
        <div class="sidebar-primary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#MTZ-IO">MTZ IO</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Build-Pipeline">Build Pipeline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Build-Workflow">Build Workflow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Compute-Desired-Type">Compute Desired Type</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Plots">Plots</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Estimated-Scaled-Intensities.">Estimated Scaled Intensities.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Curve-Fitting">Curve Fitting</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Change-Provider">Change Provider</a></li>
</ul>
  </nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user-guide/scaling_workflow.ipynb"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Scaling</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="Scaling">
<h1>Scaling<a class="headerlink" href="#Scaling" title="Link to this heading">#</a></h1>
<section id="MTZ-IO">
<h2>MTZ IO<a class="headerlink" href="#MTZ-IO" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ess.nmx</span></code> has <code class="docutils literal notranslate"><span class="pre">MTZ</span></code> IO helper functions. They can be used as providers in a workflow of scaling routine.</p>
<p>They are wrapping <code class="docutils literal notranslate"><span class="pre">MTZ</span></code> IO functions of <code class="docutils literal notranslate"><span class="pre">gemmi</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">gemmi</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ess.nmx.mtz_io</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">read_mtz_file</span><span class="p">,</span>
    <span class="n">mtz_to_pandas</span><span class="p">,</span>
    <span class="n">MTZFilePath</span><span class="p">,</span>
    <span class="n">get_unique_space_group</span><span class="p">,</span>
    <span class="n">MtzDataFrame</span><span class="p">,</span>
    <span class="n">merge_mtz_dataframes</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ess.nmx.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_small_random_mtz_samples</span>


<span class="n">small_mtz_sample</span> <span class="o">=</span> <span class="n">get_small_random_mtz_samples</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">mtz</span> <span class="o">=</span> <span class="n">read_mtz_file</span><span class="p">(</span><span class="n">MTZFilePath</span><span class="p">(</span><span class="n">small_mtz_sample</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">mtz_to_pandas</span><span class="p">(</span><span class="n">mtz</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Downloading file &#39;mtz_random_samples.tar.gz&#39; from &#39;https://public.esss.dk/groups/scipp/ess/nmx/1/mtz_random_samples.tar.gz&#39; to &#39;/home/runner/.cache/ess/nmx&#39;.
Untarring contents of &#39;/home/runner/.cache/ess/nmx/mtz_random_samples.tar.gz&#39; to &#39;/home/runner/.cache/ess/nmx/mtz_random_samples.tar.gz.untar&#39;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>I</th>
      <th>SIGI</th>
      <th>LAMBDA</th>
      <th>H</th>
      <th>K</th>
      <th>L</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>124.962219</td>
      <td>16.215948</td>
      <td>3.199984</td>
      <td>34.0</td>
      <td>99.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>120.856743</td>
      <td>14.550026</td>
      <td>3.199915</td>
      <td>-25.0</td>
      <td>-24.0</td>
      <td>71.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>119.300064</td>
      <td>13.047421</td>
      <td>3.199908</td>
      <td>52.0</td>
      <td>-84.0</td>
      <td>63.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>117.497627</td>
      <td>16.257229</td>
      <td>3.199904</td>
      <td>-36.0</td>
      <td>93.0</td>
      <td>18.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>114.670326</td>
      <td>11.597502</td>
      <td>3.199864</td>
      <td>-96.0</td>
      <td>51.0</td>
      <td>-47.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Build-Pipeline">
<h2>Build Pipeline<a class="headerlink" href="#Build-Pipeline" title="Link to this heading">#</a></h2>
<p>Scaling routine includes:</p>
<ul class="simple">
<li><p>Reducing individual MTZ dataset</p></li>
<li><p>Merging MTZ dataset</p></li>
<li><p>Reducing merged MTZ dataset</p></li>
</ul>
<p>These operations are done on pandas dataframe as recommended in <code class="docutils literal notranslate"><span class="pre">gemmi</span></code>. And multiple MTZ files are expected, so we need to use <code class="docutils literal notranslate"><span class="pre">sciline.ParamTable</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sciline</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sc</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">ess.nmx.mtz_io</span><span class="w"> </span><span class="kn">import</span> <span class="n">providers</span> <span class="k">as</span> <span class="n">mtz_io_providers</span><span class="p">,</span> <span class="n">default_parameters</span> <span class="k">as</span> <span class="n">mtz_io_params</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ess.nmx.mtz_io</span><span class="w"> </span><span class="kn">import</span> <span class="n">SpaceGroupDesc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ess.nmx.scaling</span><span class="w"> </span><span class="kn">import</span> <span class="n">providers</span> <span class="k">as</span> <span class="n">scaling_providers</span><span class="p">,</span> <span class="n">default_parameters</span> <span class="k">as</span> <span class="n">scaling_params</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ess.nmx.scaling</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">WavelengthBins</span><span class="p">,</span>
    <span class="n">FilteredEstimatedScaledIntensities</span><span class="p">,</span>
    <span class="n">ReferenceWavelength</span><span class="p">,</span>
    <span class="n">ScaledIntensityLeftTailThreshold</span><span class="p">,</span>
    <span class="n">ScaledIntensityRightTailThreshold</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">pl</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">providers</span><span class="o">=</span><span class="n">mtz_io_providers</span> <span class="o">+</span> <span class="n">scaling_providers</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span><span class="p">{</span>
        <span class="n">SpaceGroupDesc</span><span class="p">:</span> <span class="s2">&quot;C 1 2 1&quot;</span><span class="p">,</span>
        <span class="n">ReferenceWavelength</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
            <span class="mi">3</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">angstrom</span>
        <span class="p">),</span>  <span class="c1"># Remove it if you want to use the middle of the bin</span>
        <span class="n">ScaledIntensityLeftTailThreshold</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
            <span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># Increase it to remove more outliers</span>
        <span class="p">),</span>
        <span class="n">ScaledIntensityRightTailThreshold</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
            <span class="mf">4.0</span><span class="p">,</span>  <span class="c1"># Decrease it to remove more outliers</span>
        <span class="p">),</span>
        <span class="o">**</span><span class="n">mtz_io_params</span><span class="p">,</span>
        <span class="o">**</span><span class="n">scaling_params</span><span class="p">,</span>
        <span class="n">WavelengthBins</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>
<span class="n">pl</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div class="pipeline-html-repr">
      <table>
        <thead>
          <tr>
            <th scope="col">Name</th>
            <th scope="col">Value</th>
            <th scope="col">Source</th>
          </tr>
        </thead>
        <tbody>

        <tr>
          <td scope="row">EstimatedScaleFactor</td>
          <td scope="row"></td>
          <td scope="row">
    <details>
      <summary>estimate_scale_factor_per_hkl_asu_from_reference</summary>
      ess.nmx.scaling.estimate_scale_factor_per_hkl_asu_from_reference
    </details>
    </th>
        </tr>

        <tr>
          <td scope="row">EstimatedScaledIntensities</td>
          <td scope="row"></td>
          <td scope="row">
    <details>
      <summary>average_roughly_scaled_intensities</summary>
      ess.nmx.scaling.average_roughly_scaled_intensities
    </details>
    </th>
        </tr>

        <tr>
          <td scope="row">FilteredEstimatedScaledIntensities</td>
          <td scope="row"></td>
          <td scope="row">
    <details>
      <summary>cut_tails</summary>
      ess.nmx.scaling.cut_tails
    </details>
    </th>
        </tr>

        <tr>
          <td scope="row">FittingResult</td>
          <td scope="row"></td>
          <td scope="row">
    <details>
      <summary>fit_wavelength_scale_factor_polynomial</summary>
      ess.nmx.scaling.fit_wavelength_scale_factor_polynomial
    </details>
    </th>
        </tr>

        <tr>
          <td scope="row">IntensityColumnName</td>
          <td scope="row">I</td>
          <td scope="row"></th>
        </tr>

        <tr>
          <td scope="row">MTZFilePath</td>
          <td scope="row"></td>
          <td scope="row"></th>
        </tr>

        <tr>
          <td scope="row">Mtz</td>
          <td scope="row"></td>
          <td scope="row">
    <details>
      <summary>read_mtz_file</summary>
      ess.nmx.mtz_io.read_mtz_file
    </details>
    </th>
        </tr>

        <tr>
          <td scope="row">MtzDataFrame</td>
          <td scope="row"></td>
          <td scope="row">
    <details>
      <summary>process_single_mtz_to_dataframe</summary>
      ess.nmx.mtz_io.process_single_mtz_to_dataframe
    </details>
    </th>
        </tr>

        <tr>
          <td scope="row">NMXMtzDataArray</td>
          <td scope="row"></td>
          <td scope="row">
    <details>
      <summary>nmx_mtz_dataframe_to_scipp_dataarray</summary>
      ess.nmx.mtz_io.nmx_mtz_dataframe_to_scipp_dataarray
    </details>
    </th>
        </tr>

        <tr>
          <td scope="row">NMXMtzDataFrame</td>
          <td scope="row"></td>
          <td scope="row">
    <details>
      <summary>process_mtz_dataframe</summary>
      ess.nmx.mtz_io.process_mtz_dataframe
    </details>
    </th>
        </tr>

        <tr>
          <td scope="row">ReciprocalAsu</td>
          <td scope="row"></td>
          <td scope="row">
    <details>
      <summary>get_reciprocal_asu</summary>
      ess.nmx.mtz_io.get_reciprocal_asu
    </details>
    </th>
        </tr>

        <tr>
          <td scope="row">ReferenceIntensities</td>
          <td scope="row"></td>
          <td scope="row">
    <details>
      <summary>get_reference_intensities</summary>
      ess.nmx.scaling.get_reference_intensities
    </details>
    </th>
        </tr>

        <tr>
          <td scope="row">ReferenceWavelength</td>
          <td scope="row">
    <details>
      <summary>&lt;scipp.Variable&gt; ()     ...</summary>
      &lt;scipp.Variable&gt; ()      int64             [Å]  3
    </details>
    </td>
          <td scope="row"></th>
        </tr>

        <tr>
          <td scope="row">ScaledIntensityLeftTailThreshold</td>
          <td scope="row">
    <details>
      <summary>&lt;scipp.Variable&gt; ()    f...</summary>
      &lt;scipp.Variable&gt; ()    float64  [dimensionless]  0.1
    </details>
    </td>
          <td scope="row"></th>
        </tr>

        <tr>
          <td scope="row">ScaledIntensityRightTailThreshold</td>
          <td scope="row">
    <details>
      <summary>&lt;scipp.Variable&gt; ()    f...</summary>
      &lt;scipp.Variable&gt; ()    float64  [dimensionless]  2
    </details>
    </td>
          <td scope="row"></th>
        </tr>

        <tr>
          <td scope="row">SelectedReferenceWavelength</td>
          <td scope="row"></td>
          <td scope="row">
    <details>
      <summary>get_reference_wavelength</summary>
      ess.nmx.scaling.get_reference_wavelength
    </details>
    </th>
        </tr>

        <tr>
          <td scope="row">SpaceGroup</td>
          <td scope="row"></td>
          <td scope="row"></th>
        </tr>

        <tr>
          <td scope="row">SpaceGroup | NoneType</td>
          <td scope="row"></td>
          <td scope="row">
    <details>
      <summary>get_space_group_from_mtz</summary>
      ess.nmx.mtz_io.get_space_group_from_mtz
    </details>
    </th>
        </tr>

        <tr>
          <td scope="row">SpaceGroupDesc</td>
          <td scope="row">C 1 2 1</td>
          <td scope="row"></th>
        </tr>

        <tr>
          <td scope="row">StdDevColumnName</td>
          <td scope="row">SIGI</td>
          <td scope="row"></th>
        </tr>

        <tr>
          <td scope="row">WavelengthBinned</td>
          <td scope="row"></td>
          <td scope="row">
    <details>
      <summary>get_wavelength_binned</summary>
      ess.nmx.scaling.get_wavelength_binned
    </details>
    </th>
        </tr>

        <tr>
          <td scope="row">WavelengthBins</td>
          <td scope="row">250</td>
          <td scope="row"></th>
        </tr>

        <tr>
          <td scope="row">WavelengthColumnName</td>
          <td scope="row">LAMBDA</td>
          <td scope="row"></th>
        </tr>

        <tr>
          <td scope="row">WavelengthFittingPolynomialDegree</td>
          <td scope="row">7</td>
          <td scope="row"></th>
        </tr>

        <tr>
          <td scope="row">WavelengthScaleFactors</td>
          <td scope="row"></td>
          <td scope="row">
    <details>
      <summary>calculate_wavelength_scale_factor</summary>
      ess.nmx.scaling.calculate_wavelength_scale_factor
    </details>
    </th>
        </tr>
        </tbody>
      </table>
    </div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">file_paths</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">MTZFilePath</span><span class="p">:</span> <span class="n">get_small_random_mtz_samples</span><span class="p">()})</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span>
    <span class="s2">&quot;mtzfile&quot;</span>
<span class="p">)</span>
<span class="n">mapped</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span>
<span class="n">pl</span><span class="p">[</span><span class="n">gemmi</span><span class="o">.</span><span class="n">SpaceGroup</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped</span><span class="p">[</span><span class="n">gemmi</span><span class="o">.</span><span class="n">SpaceGroup</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s1">&#39;mtzfile&#39;</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">get_unique_space_group</span>
<span class="p">)</span>
<span class="n">pl</span><span class="p">[</span><span class="n">MtzDataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="n">mapped</span><span class="p">[</span><span class="n">MtzDataFrame</span><span class="p">]</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s1">&#39;mtzfile&#39;</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">merge_mtz_dataframes</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Build-Workflow">
<h2>Build Workflow<a class="headerlink" href="#Build-Workflow" title="Link to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ess.nmx.scaling</span><span class="w"> </span><span class="kn">import</span> <span class="n">WavelengthScaleFactors</span>

<span class="n">scaling_nmx_workflow</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">WavelengthScaleFactors</span><span class="p">)</span>
<span class="n">scaling_nmx_workflow</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="n">graph_attr</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;rankdir&quot;</span><span class="p">:</span> <span class="s2">&quot;LR&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/user-guide_scaling_workflow_7_0.svg" src="../_images/user-guide_scaling_workflow_7_0.svg" />
</div>
</div>
</section>
<section id="Compute-Desired-Type">
<h2>Compute Desired Type<a class="headerlink" href="#Compute-Desired-Type" title="Link to this heading">#</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ess.nmx.scaling</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">SelectedReferenceWavelength</span><span class="p">,</span>
    <span class="n">FittingResult</span><span class="p">,</span>
    <span class="n">WavelengthScaleFactors</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">scaling_nmx_workflow</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span>
    <span class="p">(</span>
        <span class="n">FilteredEstimatedScaledIntensities</span><span class="p">,</span>
        <span class="n">SelectedReferenceWavelength</span><span class="p">,</span>
        <span class="n">FittingResult</span><span class="p">,</span>
        <span class="n">WavelengthScaleFactors</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">results</span><span class="p">[</span><span class="n">WavelengthScaleFactors</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><!-- Original source from -->
<!-- https://github.com/jsignell/xarray/blob/1d960933ab252e0f79f7e050e6c9261d55568057/xarray/static/html/icons-svg-inline.html -->
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<title>Show/Hide data repr</title>
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<title>Show/Hide attributes</title>
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg><style id="scipp-style-sheet">.sc-root{--sc-background-color0:var(--jp-layout-color0,#fff);--sc-background-color1:var(--jp-layout-color1,#fcfcfc);--sc-background-color2:var(--jp-layout-color2,#efefef);--sc-inverse-background-color0:var(--jp-inverse-layout-color4,#111);--sc-font-color0:var(--jp-content-font-color0,#000);--sc-font-color1:var(--jp-content-font-color1,#555);--sc-font-color2:var(--jp-content-font-color2,#888);--sc-font-color3:var(--jp-content-font-color3,#ccc);}body.vscode-dark .sc-root{--sc-font-color0:rgba(255,255,255,1);--sc-font-color1:rgba(255,255,255,0.70);--sc-font-color2:rgba(255,255,255,0.54);--sc-font-color3:rgba(255,255,255,0.38);--sc-border-color:#1F1F1F;--sc-disabled-color:#515151;--sc-background-color0:#111111;--sc-background-color1:#111111;--sc-background-color2:#313131;}.sc-wrap{font-size:14px;min-width:300px;max-width:800px;}.sc-var-attrs .sc-wrap{padding-left:3em;}.sc-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px #ddd;}.sc-header > div,.sc-header > ul{display:inline;margin-top:0;margin-bottom:0;}.sc-obj-type,.sc-array-name{margin-left:2px;margin-right:10px;}.sc-obj-type{color:var(--sc-font-color1);}.sc-underlying-size{color:var(--sc-font-color2);}.sc-sections,.reveal .sc-sections{padding-left:0 !important;display:grid;grid-template-columns:150px auto auto auto 1fr 20px 20px;}.sc-section-item{display:contents;}.sc-section-item input{display:none;}.sc-section-item input:enabled + label{cursor:pointer;color:var(--sc-font-color1);}.sc-section-item input:enabled + label:hover{color:var(--sc-font-color0);}.sc-section-summary{grid-column:1;font-weight:500;}.sc-section-summary > span{display:inline-block;padding-left:0.5em;}.sc-section-summary-in:disabled + label{color:var(--sc-font-color1);}.sc-section-summary-in + label:before{display:inline-block;content:'►';font-size:11px;width:15px;text-align:center;}.sc-section-summary-in:disabled + label:before{color:var(--sc-font-color3);}.sc-section-summary-in:checked + label:before{content:'▼';}.sc-section-summary-in:checked + label > span{display:none;}.sc-section-summary,.sc-section-inline-details{padding-top:4px;padding-bottom:4px;}.sc-section-inline-details{grid-column:2 / 6;}.sc-section-details{display:none;grid-column:1 / -1;margin-bottom:5px;}.sc-section-summary-in:checked ~ .sc-section-details{display:contents;}.sc-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto;}.sc-array-wrap > label{grid-column:1;vertical-align:top;}.sc-preview{color:var(--sc-font-color2);}.sc-array-preview,.sc-array-data{padding:0 5px !important;grid-column:2;}.sc-array-data,.sc-array-in:checked ~ .sc-array-preview{display:none;}.sc-array-in:checked ~ .sc-array-data,.sc-array-preview{display:inline-block;}.sc-dim-list{display:inline-block !important;list-style:none;padding:0 !important;margin:0;}.sc-dim-list li{display:inline-block;padding:0;margin:0!important;}.sc-dim-list:before{content:'(';}.sc-dim-list:after{content:')';}.sc-dim-list li:not(:last-child):after{content:',';padding-right:5px;}.sc-dim-list li span,.sc-standalone-var-name > span span,.sc-var-name > span span{padding:0 !important;}.sc-aligned{font-weight:bold;}.sc-var-list,.sc-var-item,.reveal .sc-var-list,.reveal .sc-var-item{display:contents;}.sc-var-item > div,.sc-var-item label,.sc-var-item > .sc-var-name span{background-color:var(--sc-background-color1);margin-bottom:0;}.sc-var-item > .sc-var-name:hover span{padding-right:5px;}.sc-var-list > li:nth-child(odd) > div,.sc-var-list > li:nth-child(odd) > label,.sc-var-list > li:nth-child(odd) > .sc-var-name span{background-color:var(--sc-background-color2);}.sc-var-name{grid-column:1;}.sc-var-dims{grid-column:2;}.sc-var-dtype{grid-column:3;text-align:right;color:var(--sc-font-color2);}.sc-var-unit{grid-column:4;text-align:left;color:var(--sc-font-color1);max-width:50pt;text-overflow:ellipsis;}.sc-value-preview{grid-column:5;}.sc-var-preview-variances{text-align:right;}.sc-sections .sc-section-item .sc-section-summary,.sc-sections .sc-section-item .sc-section-inline-details,.sc-section-item .sc-var-list .sc-var-item > div,.sc-section-item .sc-var-list .sc-var-item > label,.sc-section-details .sc-var-list .sc-var-item > div,.sc-section-details .sc-var-list .sc-var-item > label{margin-top:0;margin-bottom:0;}.sc-var-name,.sc-var-dims,.sc-var-dtype,.sc-var-unit,.sc-preview,.sc-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px;}.sc-var-name:hover,.sc-var-dims:hover,.sc-var-dtype:hover,.sc-var-unit:hover,.sc-attrs dt:hover{overflow:visible;width:auto;z-index:1;}.sc-var-attrs{display:block;}.sc-var-data,.reveal .sc-var-data{display:none;}.sc-var-attrs,.sc-var-data{background-color:var(--sc-background-color0) !important;padding-bottom:5px !important;}.sc-var-attrs-in:checked ~ .sc-var-attrs{display:none;}.sc-var-data-in:checked ~ .sc-var-data{display:block;}.sc-var-data > table{float:right;}.sc-var-name span,.sc-var-data{padding-left:25px !important;}.sc-var-attrs,.sc-var-data{grid-column:1 / -1;}dl.sc-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto;}.sc-attrs dt,dd{padding:0;margin:0;float:left;padding-right:10px;width:auto;}.sc-attrs dt{font-weight:normal;grid-column:1;}.sc-attrs dt:hover span{display:inline-block;padding-right:10px;}.sc-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all;}.sc-icon-database,.sc-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em !important;stroke-width:0;stroke:currentColor;fill:currentColor;}label.sc-hide-icon svg{opacity:0;}.sc-standalone-var-name{grid-column:1/3;}.sc-standalone-var-name span{padding-left:25px;padding-right:10px;}.sc-title{font-weight:bold;font-size:1.5em;}.sc-subtitle{font-weight:normal;font-style:italic;text-align:left;font-size:1.2em;padding:1px;}.sc-label{fill:var(--sc-font-color0,#444444);text-anchor:middle;}.sc-name{fill:var(--sc-font-color0,#111111);}.sc-inset-line{stroke:var(--sc-font-color1);stroke-width:0.05;stroke-dasharray:0.2,0.2;}.sc-log-wrap{height:25ex;resize:vertical;overflow-y:scroll;display:flex;flex-direction:column-reverse;border:1px solid;border-color:var(--jp-border-color2);background-color:var(--sc-background-color1);}div.sc-log{line-height:2.5ex;}table.sc-log{table-layout:auto;border-collapse:collapse;}tr.sc-log:nth-child(even){background-color:var(--sc-background-color0);}tr.sc-log > td{vertical-align:top;padding-bottom:0.5ex;}.sc-log-time-stamp{min-width:22ch;font-family:var(--jp-code-font-family);color:var(--sc-font-color2);}.sc-log-level{min-width:10ch;}tr.sc-log-debug td.sc-log-level{color:var(--jp-accent-color1);}tr.sc-log-info td.sc-log-level{color:var(--jp-info-color1);}tr.sc-log-warning td.sc-log-level{color:var(--jp-warn-color1);}tr.sc-log-error td.sc-log-level{font-weight:bold;color:var(--jp-error-color2);}tr.sc-log-critical td.sc-log-level{font-weight:bold;color:var(--sc-background-color0);background-color:var(--jp-error-color1);}.sc-log-message{white-space:pre-wrap;width:100%;}.sc-log-html-payload{white-space:normal;}.sc-log-name{padding-right:0.5em;text-align:right;white-space:pre-wrap;color:var(--sc-font-color3);}</style><div class='sc-wrap sc-root'><div class='sc-header'><div class='sc-obj-type'>scipp.DataArray (3.76 KB)</div></div><ul class='sc-sections'><li class='sc-section-item'><input id='section-7d34c38e-411a-4b69-8c2d-d4a953356180' class='sc-section-summary-in' type='checkbox' disabled ><label for='section-7d34c38e-411a-4b69-8c2d-d4a953356180' class='sc-section-summary' >Dimensions:</label><div class='sc-section-inline-details'><ul class='sc-dim-list'><li><span class='sc-has-index'>wavelength</span>: 247</li></ul></div><div class='sc-section-details'></div></li><li class='sc-section-item'><input id='section-60bb697a-961d-4eb6-92a4-6c8ee3145014' class='sc-section-summary-in' type='checkbox'  checked><label for='section-60bb697a-961d-4eb6-92a4-6c8ee3145014' class='sc-section-summary'  title='Expand/collapse section'>Coordinates: <span>(1)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>wavelength</span></div><div class='sc-var-dims'>(wavelength)</div><div class='sc-var-dtype'>float32</div><div class='sc-var-unit'>Å</div><div class='sc-value-preview sc-preview'><span><div>2.8012676, 2.8044639, ..., 3.1944056, 3.196004</div></span></div><input id='attrs-f942b0e5-a45c-406d-8cb8-26adc06377c7' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-f942b0e5-a45c-406d-8cb8-26adc06377c7' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-877e562d-4fbb-4fc1-b5ab-573477cb59a2' class='sc-var-data-in' type='checkbox'><label for='data-877e562d-4fbb-4fc1-b5ab-573477cb59a2' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([2.8012676, 2.8044639, 2.8060622, 2.80766  , 2.8092585, 2.8108563,
       2.8124547, 2.8140526, 2.815651 , 2.8172488, 2.8188472, 2.820445 ,
       2.8220434, 2.8236413, 2.8252397, 2.8268375, 2.828436 , 2.8300338,
       2.8316321, 2.83323  , 2.8348284, 2.8364263, 2.8380246, 2.8396225,
       2.8412209, 2.8428187, 2.844417 , 2.846015 , 2.8476133, 2.8492112,
       2.8508096, 2.8524075, 2.8540058, 2.8556037, 2.857202 , 2.8588   ,
       2.8603983, 2.8619962, 2.8635945, 2.8651924, 2.8667908, 2.8683887,
       2.869987 , 2.871585 , 2.8731833, 2.8747811, 2.8763795, 2.8779774,
       2.8795757, 2.8811736, 2.882772 , 2.8843699, 2.8859682, 2.887566 ,
       2.8891644, 2.8907623, 2.8923607, 2.8939586, 2.895557 , 2.8971548,
       2.8987532, 2.9003513, 2.9019494, 2.9035475, 2.9051456, 2.906744 ,
       2.908342 , 2.9099402, 2.9115381, 2.9131365, 2.9147344, 2.9163327,
       2.9179306, 2.919529 , 2.9211268, 2.9227252, 2.924323 , 2.9259214,
       2.9275193, 2.9291177, 2.9307156, 2.932314 , 2.9339118, 2.9355102,
       2.937108 , 2.9387064, 2.9403043, 2.9419026, 2.9435005, 2.9450989,
       2.9466968, 2.948295 , 2.949893 , 2.9514914, 2.9530892, 2.9546876,
       2.9562855, 2.9578838, 2.9594817, 2.96108  , 2.962678 , 2.9642763,
       2.9658742, 2.9674726, 2.9690704, 2.9706688, 2.9722667, 2.973865 ,
       2.975463 , 2.9770613, 2.9786592, 2.9802575, 2.9818554, 2.9834538,
       2.9850516, 2.98665  , 2.9882479, 2.9898462, 2.991444 , 2.9930425,
       2.9946404, 2.9962387, 2.9978366, 2.999435 , 3.0010328, 3.0026312,
       3.004229 , 3.0058274, 3.0074253, 3.0090237, 3.0106215, 3.01222  ,
       3.0138178, 3.0154161, 3.017014 , 3.0186124, 3.0202103, 3.0218086,
       3.0234065, 3.0250049, 3.0266027, 3.028201 , 3.029799 , 3.0313973,
       3.0329952, 3.0345936, 3.0361915, 3.0377898, 3.0393877, 3.040986 ,
       3.042584 , 3.0441823, 3.0457802, 3.0473785, 3.0489764, 3.0505748,
       3.0521727, 3.053771 , 3.055369 , 3.0569673, 3.0585651, 3.0601635,
       3.0617614, 3.0633597, 3.0649576, 3.066556 , 3.0681539, 3.0697522,
       3.07135  , 3.0729485, 3.0745463, 3.0761447, 3.0777426, 3.079341 ,
       3.0809388, 3.0825372, 3.084135 , 3.0857334, 3.0873313, 3.0889297,
       3.0905275, 3.092126 , 3.0937238, 3.0953221, 3.0969203, 3.0985184,
       3.1001165, 3.1017146, 3.1033127, 3.1049109, 3.106509 , 3.108107 ,
       3.1097052, 3.1113033, 3.1129014, 3.1144996, 3.1160977, 3.1176958,
       3.119294 , 3.120892 , 3.1224904, 3.1240883, 3.1256866, 3.1272845,
       3.128883 , 3.1304808, 3.1320791, 3.133677 , 3.1352754, 3.1368732,
       3.1384716, 3.1400695, 3.1416678, 3.1432657, 3.144864 , 3.146462 ,
       3.1480603, 3.1496582, 3.1512566, 3.1528544, 3.1544528, 3.1560507,
       3.157649 , 3.159247 , 3.1608453, 3.1624432, 3.1640415, 3.1656394,
       3.1672378, 3.1688356, 3.170434 , 3.1720319, 3.1736302, 3.175228 ,
       3.1768265, 3.1784244, 3.1800227, 3.1816206, 3.183219 , 3.1848168,
       3.1864152, 3.188013 , 3.1896114, 3.1912093, 3.1928077, 3.1944056,
       3.196004 ], dtype=float32)</pre></span></li></ul></div></li><li class='sc-section-item'><input id='section-fec75b7f-e599-4a20-945a-37dde907195f' class='sc-section-summary-in' type='checkbox'  checked><label for='section-fec75b7f-e599-4a20-945a-37dde907195f' class='sc-section-summary'  title='Expand/collapse section'>Data: <span>(1)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span></span></div><div class='sc-var-dims'>(wavelength)</div><div class='sc-var-dtype'>float64</div><div class='sc-var-unit'>𝟙</div><div class='sc-value-preview sc-preview'><span><div>0.113, 0.158, ..., 1.845, 1.868</div></span></div><input id='attrs-de2b00f4-87a8-4bc8-8fd5-35b235253cb2' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-de2b00f4-87a8-4bc8-8fd5-35b235253cb2' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b2e0cbd6-640a-44c4-ae6f-227c8f637a87' class='sc-var-data-in' type='checkbox'><label for='data-b2e0cbd6-640a-44c4-ae6f-227c8f637a87' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0.11304956, 0.15792468, 0.17930914, 0.20000859, 0.22005404,
       0.23945186, 0.25823168, 0.27640001, 0.2939851 , 0.31099356,
       0.32745236, 0.34336818, 0.35876671, 0.37365468, 0.38805658,
       0.40197915, 0.41544572, 0.428463  , 0.44105322, 0.45322305,
       0.46499364, 0.4763716 , 0.48737706, 0.49801652, 0.50830915,
       0.51826132, 0.52789125, 0.5372052 , 0.54622048, 0.55494319,
       0.56338976, 0.57156615, 0.57948795, 0.58716092, 0.59459988,
       0.60181036, 0.60880644, 0.61559343, 0.62218468, 0.62858529,
       0.63480788, 0.64085733, 0.64674561, 0.65247733, 0.65806383,
       0.66350946, 0.66882496, 0.67401442, 0.67908799, 0.68404948,
       0.68890849, 0.69366857, 0.69833879, 0.7029224 , 0.70742797,
       0.71185847, 0.71622199, 0.72052121, 0.72476377, 0.72895205,
       0.73309326, 0.73719009, 0.74124752, 0.74526976, 0.74926083,
       0.75322517, 0.75716472, 0.76108535, 0.76498811, 0.76887853,
       0.77275736, 0.77662983, 0.78049638, 0.78436195, 0.78822669,
       0.79209524, 0.79596749, 0.79984781, 0.8037358 , 0.80763558,
       0.8115465 , 0.81547242, 0.81941242, 0.82337016, 0.82734445,
       0.83133874, 0.8353516 , 0.83938627, 0.8434411 , 0.84751913,
       0.85161848, 0.85574203, 0.85988767, 0.86405812, 0.86825106,
       0.87246906, 0.87670961, 0.88097515, 0.88526296, 0.88957536,
       0.89390945, 0.89826744, 0.90264628, 0.90704805, 0.91146954,
       0.91591276, 0.92037436, 0.92485624, 0.92935494, 0.93387228,
       0.93840468, 0.9429539 , 0.94751625, 0.95209344, 0.95668169,
       0.96128266, 0.96589249, 0.97051281, 0.97513969, 0.97977474,
       0.98441398, 0.98905899, 0.99370577, 0.99835586, 1.00300528,
       1.00765554, 1.01230266, 1.01694816, 1.02158806, 1.02622391,
       1.03085174, 1.03547312, 1.04008413, 1.04468637, 1.04927596,
       1.05385454, 1.05841832, 1.06296898, 1.0675028 , 1.07202153,
       1.07652154, 1.08100464, 1.08546732, 1.08991148, 1.09433372,
       1.09873601, 1.10311512, 1.1074731 , 1.11180688, 1.11611861,
       1.12040538, 1.12466948, 1.12890815, 1.13312383, 1.13731395,
       1.14148108, 1.14562286, 1.149742  , 1.15383638, 1.15790887,
       1.16195755, 1.16598549, 1.16999102, 1.17397738, 1.17794316,
       1.1818918 , 1.18582215, 1.18973787, 1.19363807, 1.19752667,
       1.20140305, 1.20527137, 1.20913129, 1.21298725, 1.21683922,
       1.22069191, 1.22454558, 1.22840525, 1.2322715 , 1.23614967,
       1.24004063, 1.24395009, 1.24787924, 1.25183414, 1.25581689,
       1.25983215, 1.26388417, 1.26797736, 1.27211635, 1.27630594,
       1.28055114, 1.28485714, 1.28922934, 1.29367336, 1.29819499,
       1.30280027, 1.30749544, 1.31228693, 1.31718144, 1.32218585,
       1.32730807, 1.33255312, 1.33793173, 1.34344851, 1.34911481,
       1.35493557, 1.3609228 , 1.36708173, 1.3734251 , 1.37995843,
       1.38669519, 1.39364118, 1.40081066, 1.40820971, 1.41585339,
       1.42374805, 1.43190959, 1.44034462, 1.44906994, 1.45809238,
       1.46742968, 1.4770889 , 1.48708874, 1.49743648, 1.50815183,
       1.51924225, 1.53072853, 1.54261829, 1.55493343, 1.56768172,
       1.58088623, 1.59455483, 1.6087118 , 1.62336515, 1.63854039,
       1.65424559, 1.67050761, 1.68733455, 1.70475465, 1.72277602,
       1.74142832, 1.76071967, 1.7806812 , 1.80132099, 1.82267171,
       1.84474137, 1.86756426])</pre></li></ul></div></li></ul></div></div></div>
</div>
</section>
<section id="Plots">
<h2>Plots<a class="headerlink" href="#Plots" title="Link to this heading">#</a></h2>
<p>Here are plotting examples of the fitting/estimation results.</p>
<section id="Estimated-Scaled-Intensities.">
<h3>Estimated Scaled Intensities.<a class="headerlink" href="#Estimated-Scaled-Intensities." title="Link to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">stats</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">density_ax</span><span class="p">,</span> <span class="n">prob_ax</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">densities</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">FilteredEstimatedScaledIntensities</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">sc</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">FilteredEstimatedScaledIntensities</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">intensity</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Filtered Estimated Scaled Intensities</span><span class="se">\n</span><span class="s2">Density Plot&quot;</span><span class="p">,</span>
    <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">density_ax</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">densities</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s2">&quot;norm&quot;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">prob_ax</span><span class="p">)</span>
<span class="n">prob_ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Filtered Estimated Scaled Intensities</span><span class="se">\n</span><span class="s2">Probability Plot&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Filtered Estimated Scaled Intensities\nProbability Plot&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/user-guide_scaling_workflow_11_1.png" src="../_images/user-guide_scaling_workflow_11_1.png" />
</div>
</div>
</section>
<section id="Curve-Fitting">
<h3>Curve Fitting<a class="headerlink" href="#Curve-Fitting" title="Link to this heading">#</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">plopp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ess.nmx.scaling</span><span class="w"> </span><span class="kn">import</span> <span class="n">FittingResult</span>

<span class="n">chebyshev_func</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polynomial</span><span class="o">.</span><span class="n">chebyshev</span><span class="o">.</span><span class="n">Chebyshev</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
<span class="n">scale_function</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span>
    <span class="n">chebyshev_func</span> <span class="o">/</span> <span class="n">chebyshev_func</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">SelectedReferenceWavelength</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">pp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;Original Data&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="n">FilteredEstimatedScaledIntensities</span><span class="p">],</span>
        <span class="s2">&quot;Fit Result&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="n">FittingResult</span><span class="p">]</span><span class="o">.</span><span class="n">fit_output</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Fit Result [Intensities vs Wavelength]&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Chebyshev&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Fit Result&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Chebyshev&quot;</span><span class="p">:</span> <span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="s2">&quot;Fit Result&quot;</span><span class="p">:</span> <span class="s2">&quot;solid&quot;</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/user-guide_scaling_workflow_13_0.svg" src="../_images/user-guide_scaling_workflow_13_0.svg" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reference_wavelength</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">results</span><span class="p">[</span><span class="n">WavelengthScaleFactors</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
            <span class="n">results</span><span class="p">[</span><span class="n">WavelengthScaleFactors</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
        <span class="p">],</span>
        <span class="s2">&quot;wavelength&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">coords</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;wavelength&quot;</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span>
            <span class="n">results</span><span class="p">[</span><span class="n">SelectedReferenceWavelength</span><span class="p">],</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="p">},</span>
<span class="p">)</span>
<span class="n">wavelength_scale_factor_plot</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;scale_factor&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="n">WavelengthScaleFactors</span><span class="p">],</span>
        <span class="s2">&quot;reference_wavelength&quot;</span><span class="p">:</span> <span class="n">reference_wavelength</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Wavelength Scale Factors&quot;</span><span class="p">,</span>
    <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;reference_wavelength&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;reference_wavelength&quot;</span><span class="p">:</span> <span class="s2">&quot;solid&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">wavelength_scale_factor_plot</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">)</span>
<span class="n">reference_wavelength</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">SelectedReferenceWavelength</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="n">wavelength_scale_factor_plot</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="mf">3.0</span><span class="p">,</span>
    <span class="mf">0.25</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reference_wavelength</span><span class="si">=:}</span><span class="s2"> [</span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="n">SelectedReferenceWavelength</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">wavelength_scale_factor_plot</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/user-guide_scaling_workflow_14_0.svg" src="../_images/user-guide_scaling_workflow_14_0.svg" />
</div>
</div>
</section>
</section>
<section id="Change-Provider">
<h2>Change Provider<a class="headerlink" href="#Change-Provider" title="Link to this heading">#</a></h2>
<p>Here is an example of how to insert different filter function.</p>
<p>In this example, we will swap a provider that filters <code class="docutils literal notranslate"><span class="pre">EstimatedScaledIntensities</span></code> and provide <code class="docutils literal notranslate"><span class="pre">FilteredEstimatedScaledIntensities</span></code>.</p>
<p>After updating the providers, you can go back to <a class="reference internal" href="#Compute-Desired-Type"><span class="std std-ref">Compute Desired Type</span></a> and start over.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NewType</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ess.nmx.scaling</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">EstimatedScaledIntensities</span><span class="p">,</span>
    <span class="n">FilteredEstimatedScaledIntensities</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Define the new types for the filtering function</span>
<span class="n">NRoot</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s2">&quot;NRoot&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;The n-th root to be taken for the standard deviation.&quot;&quot;&quot;</span>
<span class="n">NRootStdDevCut</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s2">&quot;NRootStdDevCut&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;The number of standard deviations to be cut from the n-th root data.&quot;&quot;&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_calculate_sample_standard_deviation</span><span class="p">(</span><span class="n">var</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">Variable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sc</span><span class="o">.</span><span class="n">Variable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the sample variation of the data.</span>

<span class="sd">    This helper function is a temporary solution before</span>
<span class="sd">    we release new scipp version with the statistics helper.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>


<span class="c1"># Define the filtering function with right argument types and return type</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cut_estimated_scaled_intensities_by_n_root_std_dev</span><span class="p">(</span>
    <span class="n">scaled_intensities</span><span class="p">:</span> <span class="n">EstimatedScaledIntensities</span><span class="p">,</span>
    <span class="n">n_root</span><span class="p">:</span> <span class="n">NRoot</span><span class="p">,</span>
    <span class="n">n_root_std_dev_cut</span><span class="p">:</span> <span class="n">NRootStdDevCut</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FilteredEstimatedScaledIntensities</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter the mtz data array by the quad root of the sample standard deviation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    scaled_intensities:</span>
<span class="sd">        The scaled intensities to be filtered.</span>

<span class="sd">    n_root:</span>
<span class="sd">        The n-th root to be taken for the standard deviation.</span>
<span class="sd">        Higher n-th root means cutting is more effective on the right tail.</span>
<span class="sd">        More explanation can be found in the notes.</span>

<span class="sd">    n_root_std_dev_cut:</span>
<span class="sd">        The number of standard deviations to be cut from the n-th root data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    :</span>
<span class="sd">        The filtered scaled intensities.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check the range of the n-th root</span>
    <span class="k">if</span> <span class="n">n_root</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The n-th root should be equal to or greater than 1.&quot;</span><span class="p">)</span>

    <span class="n">copied</span> <span class="o">=</span> <span class="n">scaled_intensities</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">nth_root</span> <span class="o">=</span> <span class="n">copied</span><span class="o">.</span><span class="n">data</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n_root</span><span class="p">)</span>
    <span class="c1"># Calculate the mean</span>
    <span class="n">nth_root_mean</span> <span class="o">=</span> <span class="n">nth_root</span><span class="o">.</span><span class="n">nanmean</span><span class="p">()</span>
    <span class="c1"># Calculate the sample standard deviation</span>
    <span class="n">nth_root_std_dev</span> <span class="o">=</span> <span class="n">_calculate_sample_standard_deviation</span><span class="p">(</span><span class="n">nth_root</span><span class="p">)</span>
    <span class="c1"># Calculate the cut value</span>
    <span class="n">half_window</span> <span class="o">=</span> <span class="n">n_root_std_dev_cut</span> <span class="o">*</span> <span class="n">nth_root_std_dev</span>
    <span class="n">keep_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">nth_root_mean</span> <span class="o">-</span> <span class="n">half_window</span><span class="p">,</span> <span class="n">nth_root_mean</span> <span class="o">+</span> <span class="n">half_window</span><span class="p">)</span>

    <span class="c1"># Filter the data</span>
    <span class="k">return</span> <span class="n">FilteredEstimatedScaledIntensities</span><span class="p">(</span>
        <span class="n">copied</span><span class="p">[(</span><span class="n">nth_root</span> <span class="o">&gt;</span> <span class="n">keep_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nth_root</span> <span class="o">&lt;</span> <span class="n">keep_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="p">)</span>


<span class="n">pl</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">cut_estimated_scaled_intensities_by_n_root_std_dev</span><span class="p">)</span>
<span class="n">pl</span><span class="p">[</span><span class="n">NRoot</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">pl</span><span class="p">[</span><span class="n">NRootStdDevCut</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">pl</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">FilteredEstimatedScaledIntensities</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><!-- Original source from -->
<!-- https://github.com/jsignell/xarray/blob/1d960933ab252e0f79f7e050e6c9261d55568057/xarray/static/html/icons-svg-inline.html -->
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<title>Show/Hide data repr</title>
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<title>Show/Hide attributes</title>
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg><style id="scipp-style-sheet">.sc-root{--sc-background-color0:var(--jp-layout-color0,#fff);--sc-background-color1:var(--jp-layout-color1,#fcfcfc);--sc-background-color2:var(--jp-layout-color2,#efefef);--sc-inverse-background-color0:var(--jp-inverse-layout-color4,#111);--sc-font-color0:var(--jp-content-font-color0,#000);--sc-font-color1:var(--jp-content-font-color1,#555);--sc-font-color2:var(--jp-content-font-color2,#888);--sc-font-color3:var(--jp-content-font-color3,#ccc);}body.vscode-dark .sc-root{--sc-font-color0:rgba(255,255,255,1);--sc-font-color1:rgba(255,255,255,0.70);--sc-font-color2:rgba(255,255,255,0.54);--sc-font-color3:rgba(255,255,255,0.38);--sc-border-color:#1F1F1F;--sc-disabled-color:#515151;--sc-background-color0:#111111;--sc-background-color1:#111111;--sc-background-color2:#313131;}.sc-wrap{font-size:14px;min-width:300px;max-width:800px;}.sc-var-attrs .sc-wrap{padding-left:3em;}.sc-header{padding-top:6px;padding-bottom:6px;margin-bottom:4px;border-bottom:solid 1px #ddd;}.sc-header > div,.sc-header > ul{display:inline;margin-top:0;margin-bottom:0;}.sc-obj-type,.sc-array-name{margin-left:2px;margin-right:10px;}.sc-obj-type{color:var(--sc-font-color1);}.sc-underlying-size{color:var(--sc-font-color2);}.sc-sections,.reveal .sc-sections{padding-left:0 !important;display:grid;grid-template-columns:150px auto auto auto 1fr 20px 20px;}.sc-section-item{display:contents;}.sc-section-item input{display:none;}.sc-section-item input:enabled + label{cursor:pointer;color:var(--sc-font-color1);}.sc-section-item input:enabled + label:hover{color:var(--sc-font-color0);}.sc-section-summary{grid-column:1;font-weight:500;}.sc-section-summary > span{display:inline-block;padding-left:0.5em;}.sc-section-summary-in:disabled + label{color:var(--sc-font-color1);}.sc-section-summary-in + label:before{display:inline-block;content:'►';font-size:11px;width:15px;text-align:center;}.sc-section-summary-in:disabled + label:before{color:var(--sc-font-color3);}.sc-section-summary-in:checked + label:before{content:'▼';}.sc-section-summary-in:checked + label > span{display:none;}.sc-section-summary,.sc-section-inline-details{padding-top:4px;padding-bottom:4px;}.sc-section-inline-details{grid-column:2 / 6;}.sc-section-details{display:none;grid-column:1 / -1;margin-bottom:5px;}.sc-section-summary-in:checked ~ .sc-section-details{display:contents;}.sc-array-wrap{grid-column:1 / -1;display:grid;grid-template-columns:20px auto;}.sc-array-wrap > label{grid-column:1;vertical-align:top;}.sc-preview{color:var(--sc-font-color2);}.sc-array-preview,.sc-array-data{padding:0 5px !important;grid-column:2;}.sc-array-data,.sc-array-in:checked ~ .sc-array-preview{display:none;}.sc-array-in:checked ~ .sc-array-data,.sc-array-preview{display:inline-block;}.sc-dim-list{display:inline-block !important;list-style:none;padding:0 !important;margin:0;}.sc-dim-list li{display:inline-block;padding:0;margin:0!important;}.sc-dim-list:before{content:'(';}.sc-dim-list:after{content:')';}.sc-dim-list li:not(:last-child):after{content:',';padding-right:5px;}.sc-dim-list li span,.sc-standalone-var-name > span span,.sc-var-name > span span{padding:0 !important;}.sc-aligned{font-weight:bold;}.sc-var-list,.sc-var-item,.reveal .sc-var-list,.reveal .sc-var-item{display:contents;}.sc-var-item > div,.sc-var-item label,.sc-var-item > .sc-var-name span{background-color:var(--sc-background-color1);margin-bottom:0;}.sc-var-item > .sc-var-name:hover span{padding-right:5px;}.sc-var-list > li:nth-child(odd) > div,.sc-var-list > li:nth-child(odd) > label,.sc-var-list > li:nth-child(odd) > .sc-var-name span{background-color:var(--sc-background-color2);}.sc-var-name{grid-column:1;}.sc-var-dims{grid-column:2;}.sc-var-dtype{grid-column:3;text-align:right;color:var(--sc-font-color2);}.sc-var-unit{grid-column:4;text-align:left;color:var(--sc-font-color1);max-width:50pt;text-overflow:ellipsis;}.sc-value-preview{grid-column:5;}.sc-var-preview-variances{text-align:right;}.sc-sections .sc-section-item .sc-section-summary,.sc-sections .sc-section-item .sc-section-inline-details,.sc-section-item .sc-var-list .sc-var-item > div,.sc-section-item .sc-var-list .sc-var-item > label,.sc-section-details .sc-var-list .sc-var-item > div,.sc-section-details .sc-var-list .sc-var-item > label{margin-top:0;margin-bottom:0;}.sc-var-name,.sc-var-dims,.sc-var-dtype,.sc-var-unit,.sc-preview,.sc-attrs dt{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:10px;}.sc-var-name:hover,.sc-var-dims:hover,.sc-var-dtype:hover,.sc-var-unit:hover,.sc-attrs dt:hover{overflow:visible;width:auto;z-index:1;}.sc-var-attrs{display:block;}.sc-var-data,.reveal .sc-var-data{display:none;}.sc-var-attrs,.sc-var-data{background-color:var(--sc-background-color0) !important;padding-bottom:5px !important;}.sc-var-attrs-in:checked ~ .sc-var-attrs{display:none;}.sc-var-data-in:checked ~ .sc-var-data{display:block;}.sc-var-data > table{float:right;}.sc-var-name span,.sc-var-data{padding-left:25px !important;}.sc-var-attrs,.sc-var-data{grid-column:1 / -1;}dl.sc-attrs{padding:0;margin:0;display:grid;grid-template-columns:125px auto;}.sc-attrs dt,dd{padding:0;margin:0;float:left;padding-right:10px;width:auto;}.sc-attrs dt{font-weight:normal;grid-column:1;}.sc-attrs dt:hover span{display:inline-block;padding-right:10px;}.sc-attrs dd{grid-column:2;white-space:pre-wrap;word-break:break-all;}.sc-icon-database,.sc-icon-file-text2{display:inline-block;vertical-align:middle;width:1em;height:1.5em !important;stroke-width:0;stroke:currentColor;fill:currentColor;}label.sc-hide-icon svg{opacity:0;}.sc-standalone-var-name{grid-column:1/3;}.sc-standalone-var-name span{padding-left:25px;padding-right:10px;}.sc-title{font-weight:bold;font-size:1.5em;}.sc-subtitle{font-weight:normal;font-style:italic;text-align:left;font-size:1.2em;padding:1px;}.sc-label{fill:var(--sc-font-color0,#444444);text-anchor:middle;}.sc-name{fill:var(--sc-font-color0,#111111);}.sc-inset-line{stroke:var(--sc-font-color1);stroke-width:0.05;stroke-dasharray:0.2,0.2;}.sc-log-wrap{height:25ex;resize:vertical;overflow-y:scroll;display:flex;flex-direction:column-reverse;border:1px solid;border-color:var(--jp-border-color2);background-color:var(--sc-background-color1);}div.sc-log{line-height:2.5ex;}table.sc-log{table-layout:auto;border-collapse:collapse;}tr.sc-log:nth-child(even){background-color:var(--sc-background-color0);}tr.sc-log > td{vertical-align:top;padding-bottom:0.5ex;}.sc-log-time-stamp{min-width:22ch;font-family:var(--jp-code-font-family);color:var(--sc-font-color2);}.sc-log-level{min-width:10ch;}tr.sc-log-debug td.sc-log-level{color:var(--jp-accent-color1);}tr.sc-log-info td.sc-log-level{color:var(--jp-info-color1);}tr.sc-log-warning td.sc-log-level{color:var(--jp-warn-color1);}tr.sc-log-error td.sc-log-level{font-weight:bold;color:var(--jp-error-color2);}tr.sc-log-critical td.sc-log-level{font-weight:bold;color:var(--sc-background-color0);background-color:var(--jp-error-color1);}.sc-log-message{white-space:pre-wrap;width:100%;}.sc-log-html-payload{white-space:normal;}.sc-log-name{padding-right:0.5em;text-align:right;white-space:pre-wrap;color:var(--sc-font-color3);}</style><div class='sc-wrap sc-root'><div class='sc-header'><div class='sc-obj-type'>scipp.DataArray (2.98 KB)</div></div><ul class='sc-sections'><li class='sc-section-item'><input id='section-800c435e-a756-415b-9cf7-97462411fcb2' class='sc-section-summary-in' type='checkbox' disabled ><label for='section-800c435e-a756-415b-9cf7-97462411fcb2' class='sc-section-summary' >Dimensions:</label><div class='sc-section-inline-details'><ul class='sc-dim-list'><li><span class='sc-has-index'>wavelength</span>: 180</li></ul></div><div class='sc-section-details'></div></li><li class='sc-section-item'><input id='section-86f7d348-d009-4ced-94e3-534504d40ccf' class='sc-section-summary-in' type='checkbox'  checked><label for='section-86f7d348-d009-4ced-94e3-534504d40ccf' class='sc-section-summary'  title='Expand/collapse section'>Coordinates: <span>(1)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span class='sc-aligned'>wavelength</span></div><div class='sc-var-dims'>(wavelength)</div><div class='sc-var-dtype'>float32</div><div class='sc-var-unit'>Å</div><div class='sc-value-preview sc-preview'><span><div>2.857202, 2.8588, ..., 3.1432657, 3.144864</div></span></div><input id='attrs-8e5cefc5-3229-4d30-aaa2-218c37b66f22' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-8e5cefc5-3229-4d30-aaa2-218c37b66f22' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ca14dce5-f6ab-46dc-81a1-683233897e32' class='sc-var-data-in' type='checkbox'><label for='data-ca14dce5-f6ab-46dc-81a1-683233897e32' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([2.857202 , 2.8588   , 2.8619962, 2.8635945, 2.8651924, 2.8667908,
       2.8683887, 2.869987 , 2.871585 , 2.8731833, 2.8747811, 2.8763795,
       2.8779774, 2.8795757, 2.8811736, 2.882772 , 2.8843699, 2.8859682,
       2.887566 , 2.8891644, 2.8907623, 2.8923607, 2.8939586, 2.895557 ,
       2.8971548, 2.8987532, 2.9003513, 2.9019494, 2.9035475, 2.9051456,
       2.906744 , 2.908342 , 2.9099402, 2.9115381, 2.9131365, 2.9147344,
       2.9163327, 2.9179306, 2.919529 , 2.9211268, 2.9227252, 2.924323 ,
       2.9259214, 2.9275193, 2.9291177, 2.9307156, 2.932314 , 2.9339118,
       2.9355102, 2.937108 , 2.9387064, 2.9403043, 2.9419026, 2.9435005,
       2.9450989, 2.9466968, 2.948295 , 2.949893 , 2.9514914, 2.9530892,
       2.9546876, 2.9562855, 2.9578838, 2.9594817, 2.96108  , 2.962678 ,
       2.9642763, 2.9658742, 2.9674726, 2.9690704, 2.9706688, 2.9722667,
       2.973865 , 2.975463 , 2.9770613, 2.9786592, 2.9802575, 2.9818554,
       2.9834538, 2.9850516, 2.98665  , 2.9882479, 2.9898462, 2.991444 ,
       2.9930425, 2.9946404, 2.9962387, 2.9978366, 2.999435 , 3.0010328,
       3.0026312, 3.004229 , 3.0058274, 3.0074253, 3.0090237, 3.0106215,
       3.01222  , 3.0138178, 3.0154161, 3.017014 , 3.0186124, 3.0202103,
       3.0218086, 3.0234065, 3.0250049, 3.0266027, 3.028201 , 3.029799 ,
       3.0313973, 3.0329952, 3.0345936, 3.0361915, 3.0377898, 3.0393877,
       3.040986 , 3.042584 , 3.0441823, 3.0457802, 3.0473785, 3.0489764,
       3.0505748, 3.0521727, 3.053771 , 3.055369 , 3.0569673, 3.0585651,
       3.0601635, 3.0617614, 3.0633597, 3.0649576, 3.066556 , 3.0681539,
       3.0697522, 3.07135  , 3.0729485, 3.0745463, 3.0761447, 3.0777426,
       3.079341 , 3.0809388, 3.0825372, 3.084135 , 3.0857334, 3.0873313,
       3.0889297, 3.0905275, 3.092126 , 3.0937238, 3.0953221, 3.0969203,
       3.0985184, 3.1001165, 3.1017146, 3.1033127, 3.1049109, 3.106509 ,
       3.108107 , 3.1097052, 3.1113033, 3.1129014, 3.1144996, 3.1160977,
       3.1176958, 3.119294 , 3.120892 , 3.1224904, 3.1240883, 3.1256866,
       3.1272845, 3.128883 , 3.1304808, 3.1320791, 3.133677 , 3.1352754,
       3.1368732, 3.1384716, 3.1400695, 3.1416678, 3.1432657, 3.144864 ],
      dtype=float32)</pre></span></li></ul></div></li><li class='sc-section-item'><input id='section-7ae7e1ae-f0bc-48ff-b4fd-85d4555463d0' class='sc-section-summary-in' type='checkbox'  checked><label for='section-7ae7e1ae-f0bc-48ff-b4fd-85d4555463d0' class='sc-section-summary'  title='Expand/collapse section'>Data: <span>(1)</span></label><div class='sc-section-inline-details'></div><div class='sc-section-details'><ul class='sc-var-list'><li class='sc-var-item'><div class='sc-var-name'><span></span></div><div class='sc-var-dims'>(wavelength)</div><div class='sc-var-dtype'>float32</div><div class='sc-var-unit'>𝟙</div><div class='sc-value-preview sc-preview'><span><div>0.6070114, 0.6354325, ..., 1.4262968, 1.4329288</div></span><span><div>σ = 0.007581526, 0.009966516, ..., 0.015530329, 0.015853887</div></span></div><input id='attrs-488dca31-a5c4-4e83-90c3-495430dae40c' class='sc-var-attrs-in' type='checkbox' disabled><label for='attrs-488dca31-a5c4-4e83-90c3-495430dae40c' class='sc-hide-icon' title='Show/Hide attributes'><svg class='icon sc-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c2fa9751-5618-4e0a-999a-ba74897f5c57' class='sc-var-data-in' type='checkbox'><label for='data-c2fa9751-5618-4e0a-999a-ba74897f5c57' title='Show/Hide data repr'><svg class='icon sc-icon-database'><use xlink:href='#icon-database'></use></svg></label><pre class='sc-var-data'>Values:<br>array([0.6070114 , 0.6354325 , 0.61014795, 0.6068784 , 0.6406334 ,
       0.64477855, 0.63060856, 0.63542855, 0.6324167 , 0.6801704 ,
       0.64791816, 0.652414  , 0.6717658 , 0.6621639 , 0.6798379 ,
       0.7657368 , 0.6897617 , 0.6949786 , 0.68923384, 0.6942186 ,
       0.71312326, 0.71762073, 0.719248  , 0.71350837, 0.7397376 ,
       0.7398708 , 0.7309188 , 0.7652437 , 0.7870944 , 0.7594039 ,
       0.7531101 , 0.75556797, 0.76490945, 0.8025271 , 0.7721254 ,
       0.78140897, 0.7865576 , 0.80898607, 0.7910712 , 0.80424136,
       0.81415737, 0.8031877 , 0.8225756 , 0.82421577, 0.8191481 ,
       0.83883417, 0.8289338 , 0.83124685, 0.83585805, 0.8385015 ,
       0.84103566, 0.8469526 , 0.8568808 , 0.8694568 , 0.85906804,
       0.9218925 , 0.8691482 , 0.910457  , 0.88111806, 0.9104874 ,
       0.9135022 , 0.92319083, 0.90916634, 0.9476996 , 0.9178994 ,
       0.9017219 , 0.91642   , 1.0024371 , 0.9270845 , 0.9234043 ,
       0.9451939 , 0.9580411 , 0.95741826, 0.94907516, 0.9626036 ,
       0.9487712 , 0.9515659 , 0.9979782 , 0.9831484 , 0.9640661 ,
       0.9879607 , 0.9713198 , 0.9780923 , 1.0047737 , 0.98358345,
       0.9882377 , 0.99075764, 1.018909  , 1.0000254 , 1.0028013 ,
       1.0172088 , 1.024566  , 1.0286235 , 1.0433916 , 1.1104821 ,
       1.0264289 , 1.0312595 , 1.0576755 , 1.0381942 , 1.0659459 ,
       1.0475025 , 1.0555083 , 1.0599737 , 1.0647993 , 1.1044763 ,
       1.0716054 , 1.085836  , 1.1003727 , 1.0791866 , 1.096032  ,
       1.0906415 , 1.1422418 , 1.1413152 , 1.1131383 , 1.1150991 ,
       1.1492105 , 1.1475223 , 1.1539438 , 1.1373259 , 1.12481   ,
       1.1319934 , 1.1355053 , 1.1449871 , 1.1513128 , 1.1601958 ,
       1.1492685 , 1.2059618 , 1.1931733 , 1.2093873 , 1.172439  ,
       1.1882433 , 1.2029705 , 1.2417048 , 1.1958982 , 1.192574  ,
       1.2114031 , 1.2002187 , 1.2199563 , 1.2094076 , 1.256482  ,
       1.2189393 , 1.2234412 , 1.2631079 , 1.2533275 , 1.246985  ,
       1.2448152 , 1.2749248 , 1.2598064 , 1.2584211 , 1.26102   ,
       1.2679971 , 1.2830582 , 1.2782192 , 1.2803183 , 1.2984796 ,
       1.2955241 , 1.308334  , 1.3730578 , 1.307733  , 1.3506969 ,
       1.316869  , 1.3708428 , 1.3499488 , 1.3652765 , 1.3402617 ,
       1.3605239 , 1.3775644 , 1.3633896 , 1.385249  , 1.3687915 ,
       1.381712  , 1.3882626 , 1.3878992 , 1.4007676 , 1.4101408 ,
       1.4342211 , 1.4354299 , 1.4360559 , 1.4262968 , 1.4329288 ],
      dtype=float32)<br><br>Variances (σ²):<br>array([5.74795376e-05, 9.93314388e-05, 3.98175434e-05, 5.14143139e-05,
       6.59856814e-05, 6.35042234e-05, 5.12313964e-05, 5.03618030e-05,
       5.48519383e-05, 6.64681502e-05, 5.44289178e-05, 5.28388628e-05,
       6.18483537e-05, 6.49031790e-05, 5.17519657e-05, 1.58387702e-04,
       5.97466023e-05, 6.94945847e-05, 6.17728219e-05, 6.55613185e-05,
       6.64384133e-05, 6.10811840e-05, 6.79638761e-05, 6.27376867e-05,
       6.04419656e-05, 5.94244702e-05, 6.86752101e-05, 6.63347600e-05,
       1.16998461e-04, 7.06466308e-05, 7.18489682e-05, 6.07973707e-05,
       6.64159816e-05, 9.21256287e-05, 7.51157058e-05, 7.64880751e-05,
       7.49804167e-05, 8.41489455e-05, 8.22133006e-05, 8.44401584e-05,
       8.60130967e-05, 8.42609152e-05, 9.90535991e-05, 8.61488079e-05,
       8.50271390e-05, 8.76785271e-05, 8.34146922e-05, 7.02328107e-05,
       1.00364952e-04, 9.05520501e-05, 9.42670522e-05, 9.19481608e-05,
       9.79183460e-05, 9.65009240e-05, 8.78656865e-05, 1.20414938e-04,
       9.97904062e-05, 1.23560938e-04, 9.40254249e-05, 1.04686864e-04,
       1.14489587e-04, 1.22188212e-04, 1.13109927e-04, 1.28414715e-04,
       1.25353123e-04, 1.21911195e-04, 9.33227857e-05, 1.74027431e-04,
       1.04913488e-04, 1.25347389e-04, 1.10791552e-04, 1.26701852e-04,
       1.09050285e-04, 1.24742073e-04, 1.30781860e-04, 1.05761384e-04,
       1.11854650e-04, 1.41779499e-04, 1.31608744e-04, 1.30743283e-04,
       1.20826429e-04, 1.26319152e-04, 1.34927235e-04, 1.38158532e-04,
       1.27356092e-04, 1.19864315e-04, 1.11187808e-04, 1.48789157e-04,
       1.01213933e-04, 1.20698089e-04, 1.43554687e-04, 1.38697913e-04,
       1.25700622e-04, 1.37931595e-04, 1.61406861e-04, 1.37677387e-04,
       1.58749288e-04, 1.38160191e-04, 1.55284506e-04, 1.42545759e-04,
       1.27560212e-04, 1.42550489e-04, 1.49925720e-04, 1.52065113e-04,
       1.55441434e-04, 1.23287304e-04, 1.55261441e-04, 1.44539532e-04,
       1.24982442e-04, 1.57909060e-04, 1.49287778e-04, 2.06205310e-04,
       1.90313207e-04, 1.77068432e-04, 1.71384701e-04, 1.79194976e-04,
       1.81565265e-04, 1.82234216e-04, 1.63582881e-04, 1.53892339e-04,
       1.61651551e-04, 1.55816175e-04, 1.77663547e-04, 1.43336118e-04,
       1.79886978e-04, 1.44532270e-04, 2.15440523e-04, 1.78006536e-04,
       1.68227794e-04, 1.43395737e-04, 1.68639366e-04, 2.08071913e-04,
       2.88074225e-04, 1.69707899e-04, 2.09134174e-04, 1.68616767e-04,
       1.68781975e-04, 1.89460785e-04, 1.70585758e-04, 2.13972060e-04,
       1.83197044e-04, 1.77821799e-04, 2.12173894e-04, 1.94450797e-04,
       2.00403243e-04, 2.15643304e-04, 1.80441697e-04, 2.11129067e-04,
       2.12913204e-04, 2.02940195e-04, 1.92602383e-04, 1.97268106e-04,
       2.11366874e-04, 2.23142299e-04, 2.23695009e-04, 1.99477669e-04,
       2.05906850e-04, 2.75295926e-04, 2.21289927e-04, 2.34401392e-04,
       2.12831786e-04, 2.33427883e-04, 2.35852815e-04, 2.32453123e-04,
       2.25265467e-04, 2.60025292e-04, 2.28782679e-04, 2.31453407e-04,
       2.34481500e-04, 2.85590824e-04, 3.04085901e-04, 2.48227967e-04,
       2.44201190e-04, 2.40701804e-04, 2.76635052e-04, 2.38082663e-04,
       2.61420006e-04, 2.59264576e-04, 2.41191126e-04, 2.51345773e-04],
      dtype=float32)</pre></li></ul></div></li></ul></div></div></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="mcstas_workflow_chunk.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">McStas Workflow - Chunk by Chunk</p>
      </div>
    </a>
    <a class="right-next"
       href="installation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Installation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025 Scipp contributors.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 9.0.4.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><!-- This will display the version of the docs -->
Current ESSnmx version: 26.1.0 (<a href="https://github.com/scipp/essnmx/releases">older versions</a>).</div>
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>